

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2D generator (Keras) &mdash; EM Image Segmentation  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2D generator (Custom)" href="2d_generator.html" />
    <link rel="prev" title="Data manipulation 2D" href="data_2d_manipulation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> EM Image Segmentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="how_to_run.html">How to run</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="post_processing.html">Post processing</a></li>
</ul>
<p class="caption"><span class="caption-text">2D Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_2d_manipulation.html">Data manipulation 2D</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2D generator (Keras)</a></li>
<li class="toctree-l1"><a class="reference internal" href="2d_generator.html">2D generator (Custom)</a></li>
</ul>
<p class="caption"><span class="caption-text">3D Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_3d_manipulation.html">Data manipulation 3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d_generator.html">3D generator</a></li>
</ul>
<p class="caption"><span class="caption-text">Networks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="networks_unet2d.html">U-Net 2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks_unet3d.html">U-Net 3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks_fcn.html">FCN</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks_fc_densetnet103.html">Tiramisu (FC-DenseNet103)</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks_multiresunet.html">MultiResUNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks_mnet.html">MNet</a></li>
</ul>
<p class="caption"><span class="caption-text">Reproduced methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="casser.html">Casser et al.</a></li>
<li class="toctree-l1"><a class="reference internal" href="xiao.html">Xiao et al.</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheng.html">Cheng et al.</a></li>
<li class="toctree-l1"><a class="reference internal" href="oztel.html">Oztel et al.</a></li>
</ul>
<p class="caption"><span class="caption-text">Auxiliary code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="grad_cam.html">Grad-CAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="adabound.html">Adabound</a></li>
<li class="toctree-l1"><a class="reference internal" href="callbacks.html">Callbacks</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EM Image Segmentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>2D generator (Keras)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-generators.keras_da_gen">
<span id="d-generator-keras"></span><h1>2D generator (Keras)<a class="headerlink" href="#module-generators.keras_da_gen" title="Permalink to this headline">Â¶</a></h1>
<dl class="py function">
<dt id="generators.keras_da_gen.keras_da_generator">
<code class="sig-prename descclassname">generators.keras_da_gen.</code><code class="sig-name descname">keras_da_generator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X_train</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_train</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">X_val</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_val</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ld_img_from_disk</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">data_paths</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">target_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">c_target_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">batch_size_value</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">val</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">save_examples</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">out_dir</span><span class="o">=</span><span class="default_value">'aug'</span></em>, <em class="sig-param"><span class="n">hflip</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">vflip</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">seedValue</span><span class="o">=</span><span class="default_value">42</span></em>, <em class="sig-param"><span class="n">rotation_range</span><span class="o">=</span><span class="default_value">180</span></em>, <em class="sig-param"><span class="n">fill_mode</span><span class="o">=</span><span class="default_value">'reflect'</span></em>, <em class="sig-param"><span class="n">preproc_function</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">featurewise_center</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">brightness_range</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">channel_shift_range</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">shuffle_train</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">shuffle_val</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">featurewise_std_normalization</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">zoom</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">w_shift_r</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">h_shift_r</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">shear_range</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">random_crops_in_DA</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">crop_length</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">weights_on_data</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">weights_path</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/generators/keras_da_gen.html#keras_da_generator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#generators.keras_da_gen.keras_da_generator" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Makes data augmentation of the given input data based on Keras
<code class="docutils literal notranslate"><span class="pre">ImageDataGenerator</span></code> class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Train data. If provided <code class="docutils literal notranslate"><span class="pre">data_paths</span></code> arg value will be avoided.
E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y_train</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Train mask data. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>X_val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Validation data. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y_val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Validation mask data. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>ld_img_from_disk</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â To make the generator with images loaded form disk instead of use
<code class="docutils literal notranslate"><span class="pre">X_train</span></code>, <code class="docutils literal notranslate"><span class="pre">Y_train</span></code>, <code class="docutils literal notranslate"><span class="pre">X_val</span></code> and <code class="docutils literal notranslate"><span class="pre">Y_val</span></code>.</p></li>
<li><p><strong>data_paths</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) â List of paths where the data is stored. Use this instead of <code class="docutils literal notranslate"><span class="pre">X_train</span></code>
and <code class="docutils literal notranslate"><span class="pre">Y_train</span></code> args to do not charge the data in memory and make a
generator over the paths instead. The path order is this: 1) train
images path 2) train masks path 3) validation images path 4) validation
masks path 5) test images path 6) test masks path 7) complete images
path (this last useful to make the smoothing post processing, as it
requires the reconstructed data) 8) complete mask path. To provide the
validation data val must be set to <code class="docutils literal notranslate"><span class="pre">True</span></code>. If no validation data
provided the order of the paths is the same avoiding validation ones.</p></li>
<li><p><strong>target_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">int</span> <span class="pre">tuple</span></code>, <em>optional</em>) â Size where the images will be resized if data_paths is defined.</p></li>
<li><p><strong>c_target_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">int</span> <span class="pre">tuple</span></code>, <em>optional</em>) â Size where complete images will be resized if data_paths is defined.</p></li>
<li><p><strong>batch_size_value</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Batch size value.</p></li>
<li><p><strong>val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â If <code class="docutils literal notranslate"><span class="pre">True</span></code> validation data generator will be returned.</p></li>
<li><p><strong>save_examples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â If <code class="docutils literal notranslate"><span class="pre">True</span></code> 5 examples of DA are stored.</p></li>
<li><p><strong>out_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">string</span></code>, <em>optional</em>) â Save directory suffix.</p></li>
<li><p><strong>hflip</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â If <code class="docutils literal notranslate"><span class="pre">True</span></code> horizontal flips are made.</p></li>
<li><p><strong>vflip</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â If <code class="docutils literal notranslate"><span class="pre">True</span></code> vertical flip are made.</p></li>
<li><p><strong>seedValue</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Seed value.</p></li>
<li><p><strong>rotation_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Range of rotation degrees.</p></li>
<li><p><strong>fill_mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) â <code class="docutils literal notranslate"><span class="pre">ImageDataGenerator</span></code> of Keras fill mode values.</p></li>
<li><p><strong>preproc_function</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">function</span></code>, <em>optional</em>) â Preprocessing function to apply.</p></li>
<li><p><strong>featurewise_center</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Set input mean to 0 over the dataset, feature-wise.</p></li>
<li><p><strong>brightness_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">float</span> <span class="pre">tuple</span></code>, <em>optional</em>) â Range for picking a brightness shift value from.</p></li>
<li><p><strong>channel_shift_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Range for random channel shifts.</p></li>
<li><p><strong>shuffle_train</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Randomize the training data on each epoch.</p></li>
<li><p><strong>shuffle_val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Randomize the validation data on each epoch.</p></li>
<li><p><strong>featurewise_std_normalization</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Divide inputs by std of the dataset, feature-wise.</p></li>
<li><p><strong>zoom</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Range for random zoom.</p></li>
<li><p><strong>w_shift_r</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Width shift range.</p></li>
<li><p><strong>h_shift_r</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Height shift range.</p></li>
<li><p><strong>shear_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Range to apply shearing transformations.</p></li>
<li><p><strong>random_crops_in_DA</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Decide to make random crops in DA (after transformations).</p></li>
<li><p><strong>crop_length</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Length of the random crop before DA.</p></li>
<li><p><strong>weights_on_data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â To make a weights generator for the weighted loss.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>train_generator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>) â Train data iterator.</p></li>
<li><p><strong>val_generator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Validation data iterator.</p></li>
<li><p><strong>X_test_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Test data iterator.</p></li>
<li><p><strong>Y_test_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Test masks iterator.</p></li>
<li><p><strong>W_test_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Test weight maps iterator.</p></li>
<li><p><strong>X_complete_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Original data iterator useful to make the smoothing post processing,
as it requires the reconstructed data.</p></li>
<li><p><strong>Y_complete_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Original mask iterator.</p></li>
<li><p><strong>W_complete_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>, <em>optional</em>) â Original weight maps iterator.</p></li>
<li><p><strong>n_train_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Number of training samples.</p></li>
<li><p><strong>n_val_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Number of validation samples.</p></li>
<li><p><strong>n_test_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Number of test samples.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXAMPLE 1</span>
<span class="c1"># Create a train and val data generators making random rotations between</span>
<span class="c1"># 0 and 180 degrees and vertical/horizontal flips.</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1776</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1776</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">204</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">Y_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">204</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">train_generator</span><span class="p">,</span> <span class="n">val_generator</span> <span class="o">=</span> <span class="n">keras_da_generator</span><span class="p">(</span>
    <span class="n">X_train</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X_val</span><span class="o">=</span><span class="n">X_val</span><span class="p">,</span> <span class="n">Y_val</span><span class="o">=</span><span class="n">Y_val</span><span class="p">,</span>
    <span class="n">batch_size_value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">save_examples</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="s1">&#39;da_out&#39;</span><span class="p">,</span>
    <span class="n">shuffle_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle_val</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rotation_range</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
    <span class="n">vflip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hflip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># EXAMPLE 2</span>
<span class="c1"># Generate random crops on DA-time. To allow that notice that the</span>
<span class="c1"># data in this case is bigger in width and height than example 1, to</span>
<span class="c1"># allow a (256, 256) random crop extraction</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">148</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">148</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">17</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">Y_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">17</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">train_generator</span><span class="p">,</span>
<span class="n">val_generator</span> <span class="o">=</span> <span class="n">keras_da_generator</span><span class="p">(</span>
    <span class="n">X_train</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X_val</span><span class="o">=</span><span class="n">X_val</span><span class="p">,</span> <span class="n">Y_val</span><span class="o">=</span><span class="n">Y_val</span><span class="p">,</span>
    <span class="n">batch_size_value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">save_examples</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="s1">&#39;da_out&#39;</span><span class="p">,</span>
    <span class="n">shuffle_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle_val</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rotation_range</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
    <span class="n">random_crops_in_DA</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">vflip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hflip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="generators.keras_da_gen.keras_gen_samples">
<code class="sig-prename descclassname">generators.keras_da_gen.</code><code class="sig-name descname">keras_gen_samples</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_samples</span></em>, <em class="sig-param"><span class="n">X_data</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_data</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ld_img_from_disk</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">data_paths</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">target_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">batch_size_value</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">shuffle_data</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">hflip</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">vflip</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">seedValue</span><span class="o">=</span><span class="default_value">42</span></em>, <em class="sig-param"><span class="n">rotation_range</span><span class="o">=</span><span class="default_value">180</span></em>, <em class="sig-param"><span class="n">fill_mode</span><span class="o">=</span><span class="default_value">'reflect'</span></em>, <em class="sig-param"><span class="n">preproc_function</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">featurewise_center</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">brightness_range</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">channel_shift_range</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">featurewise_std_normalization</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">zoom</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">w_shift_r</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">h_shift_r</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">shear_range</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/generators/keras_da_gen.html#keras_gen_samples"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#generators.keras_da_gen.keras_gen_samples" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Generates samples based on keras da generator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) â Number of samples to create.</p></li>
<li><p><strong>X_data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Data used to generate samples. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y_data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Mask used to generate samples. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>ld_img_from_disk</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â To advise the function to load images from disk instead of use
<code class="docutils literal notranslate"><span class="pre">X_data</span></code> and <code class="docutils literal notranslate"><span class="pre">Y_data</span></code>.</p></li>
<li><p><strong>data_paths</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) â Path were the data and mask are stored to generate the new samples.</p></li>
<li><p><strong>target_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">int</span> <span class="pre">tuple</span></code>, <em>optional</em>) â Shape of the images to load from disk.</p></li>
<li><p><strong>batch_size_value</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Batch size value.</p></li>
<li><p><strong>shuffle_data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Shuffle the data while generating new samples.</p></li>
<li><p><strong>hflip</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â If <code class="docutils literal notranslate"><span class="pre">True</span></code> horizontal flips are made.</p></li>
<li><p><strong>vflip</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â If <code class="docutils literal notranslate"><span class="pre">True</span></code> vertical flip are made.</p></li>
<li><p><strong>seedValue</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Seed value.</p></li>
<li><p><strong>rotation_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Range of rotation degrees.</p></li>
<li><p><strong>fill_mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) â <code class="docutils literal notranslate"><span class="pre">ImageDataGenerator</span></code> of Keras fill mode values.</p></li>
<li><p><strong>preproc_function</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">function</span></code>, <em>optional</em>) â Preprocessing function to apply.</p></li>
<li><p><strong>featurewise_center</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Set input mean to 0 over the dataset, feature-wise.</p></li>
<li><p><strong>brightness_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">float</span> <span class="pre">tuple</span></code>, <em>optional</em>) â Range for picking a brightness shift value from.</p></li>
<li><p><strong>channel_shift_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Range for random channel shifts.</p></li>
<li><p><strong>featurewise_std_normalization</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â Divide inputs by std of the dataset, feature-wise.</p></li>
<li><p><strong>zoom</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Range for random zoom.</p></li>
<li><p><strong>w_shift_r</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Width shift range.</p></li>
<li><p><strong>h_shift_r</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Height shift range.</p></li>
<li><p><strong>shear_range</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) â Range to apply shearing transformations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>x_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) â Data new samples. E.g. <code class="docutils literal notranslate"><span class="pre">(num_samples,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>y_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) â Mask new samples. E.g. <code class="docutils literal notranslate"><span class="pre">(num_samples,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="generators.keras_da_gen.prepare_weight_maps">
<code class="sig-prename descclassname">generators.keras_da_gen.</code><code class="sig-name descname">prepare_weight_maps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">train_w_path</span></em>, <em class="sig-param"><span class="n">val_w_path</span></em>, <em class="sig-param"><span class="n">test_w_path</span></em>, <em class="sig-param"><span class="n">c_w_path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_train</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_val</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_test</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ld_img_from_disk</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">Y_train_aug</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_val_aug</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_test_aug</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y_cmp_aug</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">batch_size_value</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/generators/keras_da_gen.html#prepare_weight_maps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#generators.keras_da_gen.prepare_weight_maps" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Prepare weight maps saving them into a given path. When the paths exist
it suposses that weight maps are already generated. Uses
<a class="reference internal" href="util.html#util.make_weight_map" title="util.make_weight_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">util.make_weight_map()</span></code></a> and <a class="reference internal" href="util.html#util.do_save_wm" title="util.do_save_wm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">util.do_save_wm()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_w_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) â Path where train images should be stored.</p></li>
<li><p><strong>val_w_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) â Path where validation images should be stored.</p></li>
<li><p><strong>test_w_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) â Path where test images should be stored.</p></li>
<li><p><strong>c_w_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) â Path where complete images should be stored. Ignored if
<code class="docutils literal notranslate"><span class="pre">ld_img_from_disk</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>Y_train</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Train mask data used to generate weight maps.
E.g.``(num_of_images, x, y, channels)``.</p></li>
<li><p><strong>Y_val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Validation mask data used to generate weight maps.
E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y_test</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">array</span></code>, <em>optional</em>) â Test mask data used to generate weight maps.
E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>ld_img_from_disk</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â To advise the function to load images from disk instead of use
<code class="docutils literal notranslate"><span class="pre">Y_train_aug</span></code>, <code class="docutils literal notranslate"><span class="pre">Y_val_aug</span></code> and <code class="docutils literal notranslate"><span class="pre">Y_test_aug</span></code>.</p></li>
<li><p><strong>Y_train_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>, <em>optional</em>) â Train mask generator used to produce weight maps.</p></li>
<li><p><strong>Y_val_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>, <em>optional</em>) â Validation mask generator used to produce weight maps.</p></li>
<li><p><strong>Y_test_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>, <em>optional</em>) â Test mask generator used to produce weight maps.</p></li>
<li><p><strong>Y_cmp_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>, <em>optional</em>) â Complete image mask generator used to produce weight maps.</p></li>
<li><p><strong>batch_size_value</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) â Batch size value.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="generators.keras_da_gen.combine_generators">
<code class="sig-prename descclassname">generators.keras_da_gen.</code><code class="sig-name descname">combine_generators</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X_aug</span></em>, <em class="sig-param"><span class="n">Y_aug</span></em>, <em class="sig-param"><span class="n">W_aug</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/generators/keras_da_gen.html#combine_generators"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#generators.keras_da_gen.combine_generators" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Combine generators into one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>) â Image generator.</p></li>
<li><p><strong>Y_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>) â Mask generator.</p></li>
<li><p><strong>W_aug</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>, <em>optional</em>) â Weight map generator.</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p><strong>out</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2</span> <span class="pre">element</span> <span class="pre">list</span></code>) â One batch of the generator.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="generators.keras_da_gen.crop_generator">
<code class="sig-prename descclassname">generators.keras_da_gen.</code><code class="sig-name descname">crop_generator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">generator</span></em>, <em class="sig-param"><span class="n">crop_length</span></em>, <em class="sig-param"><span class="n">val</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">weights_on_data</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/generators/keras_da_gen.html#crop_generator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#generators.keras_da_gen.crop_generator" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Generate random crops of the images extracted from a generator. Uses
<code class="xref py py-meth docutils literal notranslate"><span class="pre">util.random_crop()</span></code> to make the crop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>generator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">ImageDataGenerator</span></code>) â Generator to extract images from.</p></li>
<li><p><strong>crop_length</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) â Size of the crop. Its shape will be square:
<code class="docutils literal notranslate"><span class="pre">(crop_length,</span> <span class="pre">crop_length)</span></code>.</p></li>
<li><p><strong>val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â To advise the function that the given data is for validation, which
ensures that the crop choosen will be always the same: starting from
(0,0) coords.</p></li>
<li><p><strong>weights_on_data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) â To advise the method that weights on data should be unpacked from the
batches extracted from the generator.</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p><strong>out</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2</span> <span class="pre">element</span> <span class="pre">list</span></code>) â One batch of the generator.</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2d_generator.html" class="btn btn-neutral float-right" title="2D generator (Custom)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data_2d_manipulation.html" class="btn btn-neutral float-left" title="Data manipulation 2D" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Daniel Franco

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>