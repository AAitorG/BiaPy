

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Util &mdash; EM Image Segmentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bibliography" href="../bibliography.html" />
    <link rel="prev" title="Grad-CAM" href="grad_cam.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> EM Image Segmentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">How to run</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to_run/bash.html">Bash shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_run/colab.html">Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_run/docker.html">Docker container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_run/singularity.html">Singularity container</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/mitochondria.html">2D Mitochondria segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/nucleus.html">3D Nuclei Instance Segmentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Manuscripts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../manuscripts/stable_mitochondria.html">Stable DNN architectures for mitochondria segmentation</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../config/main_config.html">config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/data.html">data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.html">engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.html">models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sota_implementations/sota_implementations.html">sota_implementations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="utils.html">utils</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="adabound.html">Adabound</a></li>
<li class="toctree-l2"><a class="reference internal" href="callbacks.html">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="grad_cam.html">Grad-CAM</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Util</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EM Image Segmentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../API.html">&lt;no title&gt;</a> &raquo;</li>
        
          <li><a href="utils.html">utils</a> &raquo;</li>
        
      <li>Util</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-utils.util">
<span id="util"></span><h1>Util<a class="headerlink" href="#module-utils.util" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="utils.util.limit_threads">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">limit_threads</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">threads_number</span><span class="o">=</span><span class="default_value">'1'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#limit_threads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.limit_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>Limits the number of threads for a python process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>threads_number</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of threads.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.set_seed">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">set_seed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seedValue</span><span class="o">=</span><span class="default_value">42</span></em>, <em class="sig-param"><span class="n">determinism</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#set_seed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.set_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the seed on multiple python modules to obtain results as reproducible as possible.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seedValue</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Seed value.</p></li>
<li><p><strong>determinism</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – To force determism.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.create_plots">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">create_plots</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">results</span></em>, <em class="sig-param"><span class="n">job_id</span></em>, <em class="sig-param"><span class="n">chartOutDir</span></em>, <em class="sig-param"><span class="n">metric</span><span class="o">=</span><span class="default_value">'jaccard_index'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#create_plots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.create_plots" title="Permalink to this definition">¶</a></dt>
<dd><p>Create loss and main metric plots with the given results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">History</span> <span class="pre">object</span></code>) – Record of training loss values and metrics values at successive epochs. History object is returned by Keras
<a class="reference external" href="https://keras.io/api/models/model_training_apis/#fit-method">fit()</a> method.</p></li>
<li><p><strong>job_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Jod identifier.</p></li>
<li><p><strong>chartOutDir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the charts will be stored into.</p></li>
<li><p><strong>metric</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Metric used.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/chart_loss.png"><img alt="../_images/chart_loss.png" src="../_images/chart_loss.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Loss values on each epoch</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/chart_jaccard_index.png"><img alt="../_images/chart_jaccard_index.png" src="../_images/chart_jaccard_index.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Jaccard index values on each epoch</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py function">
<dt id="utils.util.threshold_plots">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">threshold_plots</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">preds_test</span></em>, <em class="sig-param"><span class="n">Y_test</span></em>, <em class="sig-param"><span class="n">det_eval_ge_path</span></em>, <em class="sig-param"><span class="n">det_eval_path</span></em>, <em class="sig-param"><span class="n">det_bin</span></em>, <em class="sig-param"><span class="n">n_dig</span></em>, <em class="sig-param"><span class="n">job_id</span></em>, <em class="sig-param"><span class="n">job_file</span></em>, <em class="sig-param"><span class="n">char_dir</span></em>, <em class="sig-param"><span class="n">r_val</span><span class="o">=</span><span class="default_value">0.5</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#threshold_plots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.threshold_plots" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a plot with the different metric values binarizing the prediction with different thresholds, from <code class="docutils literal notranslate"><span class="pre">0.1</span></code>
to <code class="docutils literal notranslate"><span class="pre">0.9</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>preds_test</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Predictions made by the model. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y_test</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Ground truth of the data. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>det_eval_ge_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the ground truth is stored for the DET calculation.</p></li>
<li><p><strong>det_eval_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the evaluation of the metric will be done.</p></li>
<li><p><strong>det_bin</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to the DET binary.</p></li>
<li><p><strong>n_dig</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The number of digits used for encoding temporal indices (e.g. <code class="docutils literal notranslate"><span class="pre">3</span></code>). Used by the DET calculation binary.</p></li>
<li><p><strong>job_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Id of the job.</p></li>
<li><p><strong>job_file</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Id and run number of the job.</p></li>
<li><p><strong>char_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to store the charts generated.</p></li>
<li><p><strong>r_val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Threshold values to return.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>t_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Value of the Jaccard index when the threshold is <code class="docutils literal notranslate"><span class="pre">r_val</span></code>.</p></li>
<li><p><strong>t_voc</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Value of VOC when the threshold is <code class="docutils literal notranslate"><span class="pre">r_val</span></code>.</p></li>
<li><p><strong>t_det</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Value of DET when the threshold is <code class="docutils literal notranslate"><span class="pre">r_val</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jac</span><span class="p">,</span> <span class="n">voc</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">threshold_plots</span><span class="p">(</span>
    <span class="n">preds_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">det_eval_ge_path</span><span class="p">,</span> <span class="n">det_eval_path</span><span class="p">,</span> <span class="n">det_bin</span><span class="p">,</span>
    <span class="n">n_dig</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="s1">&#39;278_3&#39;</span><span class="p">,</span> <span class="n">char_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Will generate 3 charts, one per each metric: IoU, VOC and DET. In the x axis represents the 9 different
thresholds applied, that is: <code class="docutils literal notranslate"><span class="pre">0.1,</span> <span class="pre">0.2,</span> <span class="pre">0.3,</span> <span class="pre">...,</span> <span class="pre">0.9</span></code>. The y axis is the value of the metric in each chart. For
instance, the Jaccard/IoU chart will look like this:</p>
<a class="reference internal image-reference" href="../_images/278_3_threshold_Jaccard.png"><img alt="../_images/278_3_threshold_Jaccard.png" class="align-center" src="../_images/278_3_threshold_Jaccard.png" style="width: 60%;" /></a>
<p>In this example, the best value, <code class="docutils literal notranslate"><span class="pre">0.868</span></code>, is obtained with a threshold of <code class="docutils literal notranslate"><span class="pre">0.4</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="utils.util.array_to_img">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">array_to_img</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">data_format</span><span class="o">=</span><span class="default_value">'channels_last'</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">'float32'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#array_to_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.array_to_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a 3D Numpy array to a PIL Image instance.</p>
<p>As the Keras array_to_img function in:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/keras-team/keras-preprocessing/blob/28b8c9a57703b60ea7d23a196c59da1edf987ca0/keras_preprocessing/image/utils.py#L230">keras_preprocessing/image/utils.py</a></p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="utils.util.img_to_array">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">img_to_array</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span></em>, <em class="sig-param"><span class="n">data_format</span><span class="o">=</span><span class="default_value">'channels_last'</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">'float32'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#img_to_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.img_to_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a PIL Image instance to a Numpy array.</p>
<p>It’s a copy of the function <a class="reference external" href="https://github.com/keras-team/keras-preprocessing/blob/28b8c9a57703b60ea7d23a196c59da1edf987ca0/keras_preprocessing/image/utils.py#L288">keras_preprocessing/image/utils.py</a>.</p>
</dd></dl>

<dl class="py function">
<dt id="utils.util.save_tif">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">save_tif</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_dir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">filenames</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#save_tif"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.save_tif" title="Permalink to this definition">¶</a></dt>
<dd><p>Save images in the given directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D/5D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>, <em>optional</em>) – Data to save as images. The first dimension must be the number of images. E.g.
<code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code> or <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">z,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store X images.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>, <em>optional</em>) – Filenames that should be used when saving each image.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.save_img">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">save_img</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_dir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mask_dir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">scale_mask</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">extension</span><span class="o">=</span><span class="default_value">'.png'</span></em>, <em class="sig-param"><span class="n">filenames</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#save_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.save_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Save images in the given directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>, <em>optional</em>) – Data to save as images. The first dimension must be the number of images. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store X images.</p></li>
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>, <em>optional</em>) – Masks to save as images. The first dimension must be the number of images. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>scale_mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – To allow mask be multiplied by 255.</p></li>
<li><p><strong>mask_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store Y images.</p></li>
<li><p><strong>prefix</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store generated charts.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <em>optional</em>) – Filenames that should be used when saving each image. If any provided each image should be named as:
<code class="docutils literal notranslate"><span class="pre">prefix</span> <span class="pre">+</span> <span class="pre">&quot;_x_&quot;</span> <span class="pre">+</span> <span class="pre">image_number</span> <span class="pre">+</span> <span class="pre">extension</span></code> when <code class="docutils literal notranslate"><span class="pre">X.ndim</span> <span class="pre">&lt;</span> <span class="pre">4</span></code> and <code class="docutils literal notranslate"><span class="pre">prefix</span> <span class="pre">+</span> <span class="pre">&quot;_x_&quot;</span> <span class="pre">+</span> <span class="pre">image_number</span> <span class="pre">+</span>
<span class="pre">&quot;_&quot;</span> <span class="pre">+</span> <span class="pre">slice_numger</span> <span class="pre">+</span> <span class="pre">extension</span></code> otherwise. E.g. <code class="docutils literal notranslate"><span class="pre">prefix_x_000.png</span></code> when <code class="docutils literal notranslate"><span class="pre">X.ndim</span> <span class="pre">&lt;</span> <span class="pre">4</span></code> or
<code class="docutils literal notranslate"><span class="pre">prefix_x_000_000.png</span></code> when <code class="docutils literal notranslate"><span class="pre">X.ndim</span> <span class="pre">&gt;=</span> <span class="pre">4</span></code>.  The same applies to <code class="docutils literal notranslate"><span class="pre">Y</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.make_weight_map">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">make_weight_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">binary</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">w0</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#make_weight_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.make_weight_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a weight map in order to make the U-Net learn better the borders of cells and distinguish individual
cells that are tightly packed. These weight maps follow the methodology of the original U-Net paper.</p>
<p>Based on <a class="reference external" href="https://github.com/deepimagej/python4deepimagej/blob/499955a264e1b66c4ed2c014cb139289be0e98a4/unet/py_files/helpers.py">unet/py_files/helpers.py</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>label</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">3D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Corresponds to a label image. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>binary</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Corresponds to whether or not the labels are binary.</p></li>
<li><p><strong>w0</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Controls for the importance of separating tightly associated entities.</p></li>
<li><p><strong>sigma</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Represents the standard deviation of the Gaussian used for the weight map.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p>Notice that weight has been defined where the objects are almost touching
each other.</p>
<a class="reference internal image-reference" href="../_images/weight_map.png"><img alt="../_images/weight_map.png" class="align-center" src="../_images/weight_map.png" style="width: 650px;" /></a>
</dd></dl>

<dl class="py function">
<dt id="utils.util.do_save_wm">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">do_save_wm</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">binary</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">w0</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#do_save_wm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.do_save_wm" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves the label images, applies the weight-map algorithm and save the weight maps in a folder. Uses
internally <code class="xref py py-meth docutils literal notranslate"><span class="pre">util.make_weight_map()</span></code>.</p>
<p>Based on <a class="reference external" href="https://github.com/deepimagej/python4deepimagej/blob/499955a264e1b66c4ed2c014cb139289be0e98a4/unet/py_files/helpers.py">deepimagejunet/py_files/helpers.py</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Corresponds to given label images. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Refers to the path where the weight maps should be saved.</p></li>
<li><p><strong>binary</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Corresponds to whether or not the labels are binary.</p></li>
<li><p><strong>w0</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Controls for the importance of separating tightly associated entities.</p></li>
<li><p><strong>sigma</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Represents the standard deviation of the Gaussian used for the weight
map.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.foreground_percentage">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">foreground_percentage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mask</span></em>, <em class="sig-param"><span class="n">class_tag</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#foreground_percentage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.foreground_percentage" title="Permalink to this definition">¶</a></dt>
<dd><p>Percentage of pixels that corresponds to the class in the given image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Image mask to analize.</p></li>
<li><p><strong>class_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Class to find in the image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>x</strong> – Percentage of pixels that corresponds to the class. Value between <code class="docutils literal notranslate"><span class="pre">0</span></code>
and <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.divide_images_on_classes">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">divide_images_on_classes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">data_mask</span></em>, <em class="sig-param"><span class="n">out_dir</span></em>, <em class="sig-param"><span class="n">num_classes</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">th</span><span class="o">=</span><span class="default_value">0.8</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#divide_images_on_classes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.divide_images_on_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a folder for each class where the images that have more pixels labeled as the class (in percentage) than
the given threshold will be stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data to save as images. The first dimension must be the number of images. E. g.``(num_of_images, x, y, channels)``.</p></li>
<li><p><strong>data_mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data mask to save as images.  The first dimension must be the number of images. E. g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>out_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to save the images.</p></li>
<li><p><strong>num_classes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of classes.</p></li>
<li><p><strong>th</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Percentage of the pixels that must be labeled as a class to save it inside that class folder.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.save_filters_of_convlayer">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">save_filters_of_convlayer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">out_dir</span></em>, <em class="sig-param"><span class="n">l_num</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">img_per_row</span><span class="o">=</span><span class="default_value">8</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#save_filters_of_convlayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.save_filters_of_convlayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an image of the filters learned by a convolutional layer. One can identify the layer with <code class="docutils literal notranslate"><span class="pre">l_num</span></code> or
<code class="docutils literal notranslate"><span class="pre">name</span></code> args. If both are passed <code class="docutils literal notranslate"><span class="pre">name</span></code> will be prioritized.</p>
<p>Inspired by <a class="reference external" href="https://machinelearningmastery.com/how-to-visualize-filters-and-feature-maps-in-convolutional-neural-networks">https://machinelearningmastery.com/how-to-visualize-filters-and-feature-maps-in-convolutional-neural-networks</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">Model</span></code>) – Model where the layers are stored.</p></li>
<li><p><strong>out_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the image will be stored.</p></li>
<li><p><strong>l_num</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of the layer to extract filters from.</p></li>
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Name of the layer to extract filters from.</p></li>
<li><p><strong>prefix</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Prefix to add to the output image name.</p></li>
<li><p><strong>img_per_row</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Filters per row on the image.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">l_num</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> not provided.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To save the filters learned by the layer called <code class="docutils literal notranslate"><span class="pre">conv1</span></code> one can call
the function as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">save_filters_of_convlayer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">char_dir</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;conv1&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>That will save in <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> an image like this:</p>
<a class="reference internal image-reference" href="../_images/save_filters.png"><img alt="../_images/save_filters.png" class="align-center" src="../_images/save_filters.png" style="width: 60%;" /></a>
</dd></dl>

<dl class="py function">
<dt id="utils.util.calculate_2D_volume_prob_map">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">calculate_2D_volume_prob_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">Y_path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">w_foreground</span><span class="o">=</span><span class="default_value">0.94</span></em>, <em class="sig-param"><span class="n">w_background</span><span class="o">=</span><span class="default_value">0.06</span></em>, <em class="sig-param"><span class="n">save_dir</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#calculate_2D_volume_prob_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.calculate_2D_volume_prob_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the probability map of the given 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data to calculate the probability map from. E. g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channel)</span></code></p></li>
<li><p><strong>Y_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to load the data from in case <code class="docutils literal notranslate"><span class="pre">Y=None</span></code>.</p></li>
<li><p><strong>w_foreground</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the foreground. This value plus <code class="docutils literal notranslate"><span class="pre">w_background</span></code> must be equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>w_background</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the background. This value plus <code class="docutils literal notranslate"><span class="pre">w_foreground</span></code> must be equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>save_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to the file where the probability map will be stored.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">Y</span></code> does not have 4 dimensions.</p></li>
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">w_foreground</span> <span class="pre">+</span> <span class="pre">w_background</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>Array</strong> – Path where the probability map/s is/are stored if <code class="docutils literal notranslate"><span class="pre">Y_path</span></code> was given and there are images of different
shapes. Otherwise, an array that represents the probability map of <code class="docutils literal notranslate"><span class="pre">Y</span></code> or all loaded data files from
<code class="docutils literal notranslate"><span class="pre">Y_path</span></code> will be returned.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Str</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.calculate_3D_volume_prob_map">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">calculate_3D_volume_prob_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">Y_path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">w_foreground</span><span class="o">=</span><span class="default_value">0.94</span></em>, <em class="sig-param"><span class="n">w_background</span><span class="o">=</span><span class="default_value">0.06</span></em>, <em class="sig-param"><span class="n">save_dir</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#calculate_3D_volume_prob_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.calculate_3D_volume_prob_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the probability map of the given 3D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data to calculate the probability map from. E. g. <code class="docutils literal notranslate"><span class="pre">(num_subvolumes,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channel)</span></code></p></li>
<li><p><strong>Y_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to load the data from in case <code class="docutils literal notranslate"><span class="pre">Y=None</span></code>.</p></li>
<li><p><strong>w_foreground</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the foreground. This value plus <code class="docutils literal notranslate"><span class="pre">w_background</span></code> must be equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>w_background</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the background. This value plus <code class="docutils literal notranslate"><span class="pre">w_foreground</span></code> must be equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>save_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to the directory where the probability map will be stored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>Array</strong> – Path where the probability map/s is/are stored if <code class="docutils literal notranslate"><span class="pre">Y_path</span></code> was given and there are images of different
shapes. Otherwise, an array that represents the probability map of <code class="docutils literal notranslate"><span class="pre">Y</span></code> or all loaded data files from
<code class="docutils literal notranslate"><span class="pre">Y_path</span></code> will be returned.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Str</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">Y</span></code> does not have 5 dimensions.</p></li>
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">w_foreground</span> <span class="pre">+</span> <span class="pre">w_background</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.grayscale_2D_image_to_3D">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">grayscale_2D_image_to_3D</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">th</span><span class="o">=</span><span class="default_value">127</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#grayscale_2D_image_to_3D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.grayscale_2D_image_to_3D" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates 3D surface from each image in X based on the grayscale of each image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data that contains the images to create the surfaces from. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data mask of the same shape of X that will be converted into 3D volume, stacking multiple times each image.
Useful if you need the two data arrays to be of the same shape. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>th</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Values to ommit when creating the surfaces. Useful to reduce the amount of data in z to be created and
reduce computational time.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>Array</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – 3D surface of each image provided. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">z,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Array</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – 3D stack of each mask provided. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">z,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.check_masks">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">check_masks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">n_classes</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#check_masks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.check_masks" title="Permalink to this definition">¶</a></dt>
<dd><p>Check wheter the data masks have the correct labels inspection a few random images of the given path. If the
function gives no error one should assume that the masks are correct.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to the data mask.</p></li>
<li><p><strong>n_classes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Maximum classes that the masks must contain.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.img_to_onehot_encoding">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">img_to_onehot_encoding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span></em>, <em class="sig-param"><span class="n">num_classes</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#img_to_onehot_encoding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.img_to_onehot_encoding" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts image given into one-hot encode format.</p>
<p>The opposite function is <a class="reference internal" href="#utils.util.onehot_encoding_to_img" title="utils.util.onehot_encoding_to_img"><code class="xref py py-func docutils literal notranslate"><span class="pre">onehot_encoding_to_img()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code>) – Image. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code> or <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>num_classes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of classes to distinguish.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>one_hot_labels</strong> – Data one-hot encoded. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">num_classes)</span></code> or <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">num_classes)</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.onehot_encoding_to_img">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">onehot_encoding_to_img</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">encoded_image</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#onehot_encoding_to_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.onehot_encoding_to_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts one-hot encode image into an image with jus tone channel and all the classes represented by an integer.</p>
<p>The opposite function is <a class="reference internal" href="#utils.util.img_to_onehot_encoding" title="utils.util.img_to_onehot_encoding"><code class="xref py py-func docutils literal notranslate"><span class="pre">img_to_onehot_encoding()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>encoded_image</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code>) – Image. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code> or <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>img</strong> – Data one-hot encoded. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">num_classes)</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.load_data_from_dir">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">load_data_from_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_dir</span></em>, <em class="sig-param"><span class="n">crop</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">crop_shape</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">overlap</span><span class="o">=</span><span class="default_value">0, 0</span></em>, <em class="sig-param"><span class="n">padding</span><span class="o">=</span><span class="default_value">0, 0</span></em>, <em class="sig-param"><span class="n">return_filenames</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#load_data_from_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.load_data_from_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Load data from a directory. If <code class="docutils literal notranslate"><span class="pre">crop=False</span></code> all the data is suposed to have the same shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to read the data from.</p></li>
<li><p><strong>crop</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Crop each image into desired shape pointed by <code class="docutils literal notranslate"><span class="pre">crop_shape</span></code>.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3</span> <span class="pre">ints</span></code>, <em>optional</em>) – Shape of the crop to be made. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>overlap</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">2</span> <span class="pre">floats</span></code>, <em>optional</em>) – Amount of minimum overlap on x and y dimensions. The values must  be on range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1)</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">0%</span></code> or
<code class="docutils literal notranslate"><span class="pre">99%</span></code> of overlap. E. g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code>.</p></li>
<li><p><strong>padding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">2</span> <span class="pre">ints</span></code>, <em>optional</em>) – Size of padding to be added on each axis <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code>. E.g. <code class="docutils literal notranslate"><span class="pre">(24,</span> <span class="pre">24)</span></code>.</p></li>
<li><p><strong>return_filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Return a list with the loaded filenames. Useful when you need to save them afterwards with the same names as
the original ones.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3D</span> <span class="pre">Numpy</span> <span class="pre">arrays</span></code>) – Data loaded. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">y,</span> <span class="pre">x,</span> <span class="pre">channels)</span></code> if all files have same shape, otherwise a list of
<code class="docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">x,</span> <span class="pre">channels)</span></code> arrays will be returned.</p></li>
<li><p><strong>data_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shapes of all 3D images readed. Useful to reconstruct the original images together with <code class="docutils literal notranslate"><span class="pre">crop_shape</span></code>.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shape of the loaded 3D images after cropping. Useful to reconstruct the original images together with
<code class="docutils literal notranslate"><span class="pre">data_shape</span></code>.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Loaded filenames.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXAMPLE 1</span>
<span class="c1"># Case where we need to load 165 images of shape (1024, 768)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;data/train/x&quot;</span>

<span class="n">load_data_from_dir</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="c1"># The function will print the shape of the created array. In this example:</span>
<span class="c1">#     *** Loaded data shape is (165, 768, 1024, 1)</span>
<span class="c1"># Notice height and width swap because of Numpy ndarray terminology</span>

<span class="c1"># EXAMPLE 2</span>
<span class="c1"># Case where we need to load 165 images of shape (1024, 768) but</span>
<span class="c1"># cropping them into (256, 256, 1) patches</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;data/train/x&quot;</span>
<span class="n">crop_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">load_data_from_dir</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop_shape</span><span class="o">=</span><span class="n">crop_shape</span><span class="p">)</span>
<span class="c1"># The function will print the shape of the created array. In this example:</span>
<span class="c1">#     *** Loaded data shape is (1980, 256, 256, 1)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="utils.util.load_ct_data_from_dir">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">load_ct_data_from_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_dir</span></em>, <em class="sig-param"><span class="n">shape</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#load_ct_data_from_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.load_ct_data_from_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Load CT data from a directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to read the data from.</p></li>
<li><p><strong>shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">3D</span> <span class="pre">int</span> <span class="pre">tuple</span></code>, <em>optional</em>) – Shape of the data to load. If is not provided the shape is calculated automatically looping over all data
files and it will be  the maximum value found per axis. So, given the value the process should be faster.
E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – Data loaded. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">y,</span> <span class="pre">x,</span> <span class="pre">channels)</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXAMPLE 1</span>
<span class="c1"># Case where we need to load 165 images of shape (1024, 768)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;data/train/x&quot;</span>
<span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">load_data_from_dir</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">data_shape</span><span class="p">)</span>

<span class="c1"># The function will print list&#39;s first position array&#39;s shape. In this example:</span>
<span class="c1">#     *** Loaded data[0] shape is (165, 768, 1024, 1)</span>
<span class="c1"># Notice height and width swap because of Numpy ndarray terminology</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="utils.util.load_3d_images_from_dir">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">load_3d_images_from_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_dir</span></em>, <em class="sig-param"><span class="n">crop</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">crop_shape</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">crop_verb</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">overlap</span><span class="o">=</span><span class="default_value">0, 0, 0</span></em>, <em class="sig-param"><span class="n">padding</span><span class="o">=</span><span class="default_value">0, 0, 0</span></em>, <em class="sig-param"><span class="n">median_padding</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">return_filenames</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#load_3d_images_from_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.load_3d_images_from_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Load data from a directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to read the data from.</p></li>
<li><p><strong>crop</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Crop each 3D image when readed.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">4</span> <span class="pre">ints</span></code>, <em>optional</em>) – Shape of the subvolumes to create when cropping.  E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>crop_verb</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Wheter to use verbose mode on crop.</p></li>
<li><p><strong>overlap</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3</span> <span class="pre">floats</span></code>, <em>optional</em>) – Amount of minimum overlap on x, y and z dimensions. The values must be on range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1)</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">0%</span></code>
or <code class="docutils literal notranslate"><span class="pre">99%</span></code> of overlap. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>.</p></li>
<li><p><strong>padding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3</span> <span class="pre">ints</span></code>, <em>optional</em>) – Size of padding to be added on each axis <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>. E.g. <code class="docutils literal notranslate"><span class="pre">(24,</span> <span class="pre">24,</span> <span class="pre">24)</span></code>.</p></li>
<li><p><strong>median_padding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code> the padding value is the median value. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the added values are zeroes.</p></li>
<li><p><strong>return_filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Return a list with the loaded filenames. Useful when you need to save them afterwards with the same names as
the original ones.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">arrays</span></code>) – Data loaded. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code> if all files have same shape, otherwise a list of
<code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code> arrays will be returned.</p></li>
<li><p><strong>data_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shapes of all 3D images readed. Useful to reconstruct the original images together with <code class="docutils literal notranslate"><span class="pre">crop_shape</span></code>.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shape of the loaded 3D images after cropping. Useful to reconstruct the original images together with
<code class="docutils literal notranslate"><span class="pre">data_shape</span></code>.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Loaded filenames.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXAMPLE 1</span>
<span class="c1"># Case where we need to load 20 images of shape (1024, 1024, 91, 1)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;data/train/x&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">load_data_from_dir</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="c1"># The function will print list&#39;s first position array&#39;s shape. In this example:</span>
<span class="c1">#     *** Loaded data[0] shape is (20, 91, 1024, 1024, 1)</span>
<span class="c1"># Notice height, width and depth swap as skimage.io imread function</span>
<span class="c1"># is used to load images</span>

<span class="c1"># EXAMPLE 2</span>
<span class="c1"># Same as example 1 but with unknown shape, cropping them into (256, 256, 40, 1) subvolumes with minimum</span>
<span class="c1"># overlap and storing filenames.</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;data/train/x&quot;</span>

<span class="n">X_test</span><span class="p">,</span> <span class="n">orig_test_img_shapes</span><span class="p">,</span>            <span class="n">crop_test_img_shapes</span><span class="p">,</span> <span class="n">te_filenames</span> <span class="o">=</span> <span class="n">load_3d_images_from_dir</span><span class="p">(</span>
    <span class="n">test_path</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">overlap</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">return_filenames</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># The function will print the shape of the created array which its size is the concatenation in 0 axis of all</span>
<span class="c1"># subvolumes created for each 3D image in the given path. For example:</span>
<span class="c1">#     *** Loaded data shape is (350, 256, 256, 40, 1)</span>
<span class="c1"># Notice height, width and depth swap as skimage.io imread function is used to load images.</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="utils.util.labels_into_bcd">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">labels_into_bcd</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_mask</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'BCD'</span></em>, <em class="sig-param"><span class="n">fb_mode</span><span class="o">=</span><span class="default_value">'outer'</span></em>, <em class="sig-param"><span class="n">save_dir</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#labels_into_bcd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.labels_into_bcd" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an array with 3 channels given semantic or instance segmentation data masks. These 3 channels are:
semantic mask, contours and distance map.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data mask to create the new array from. It is expected to have just one channel. E.g. <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">1000,</span> <span class="pre">1000,</span> <span class="pre">200,</span> <span class="pre">1)</span></code></p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Operation mode. Possible values: <code class="docutils literal notranslate"><span class="pre">BC</span></code> and <code class="docutils literal notranslate"><span class="pre">BCD</span></code>.  <code class="docutils literal notranslate"><span class="pre">BC</span></code> corresponds to use binary segmentation+contour.
<code class="docutils literal notranslate"><span class="pre">BCD</span></code> stands for binary segmentation+contour+distances.</p></li>
<li><p><strong>fb_mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Mode of the find_boundaries function from <code class="docutils literal notranslate"><span class="pre">scikit-image</span></code>. More info in:
<a class="reference external" href="https://scikit-image.org/docs/stable/api/skimage.segmentation.html#skimage.segmentation.find_boundaries">find_boundaries()</a>.</p></li>
<li><p><strong>save_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store samples of the created array just to debug it is correct.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>new_mask</strong> – 5D array with 3 channels instead of one. E.g. <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">1000,</span> <span class="pre">1000,</span> <span class="pre">200,</span> <span class="pre">3)</span></code></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="utils.util.check_downsample_division">
<code class="sig-prename descclassname">utils.util.</code><code class="sig-name descname">check_downsample_division</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">d_levels</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/utils/util.html#check_downsample_division"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.util.check_downsample_division" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensures <code class="docutils literal notranslate"><span class="pre">X</span></code> shape is divisible by <code class="docutils literal notranslate"><span class="pre">2</span></code> times <code class="docutils literal notranslate"><span class="pre">d_levels</span></code> adding padding if necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data to check if its shape.  E.g. <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">1000,</span> <span class="pre">1000,</span> <span class="pre">1)</span></code>.</p></li>
<li><p><strong>d_levels</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Levels of downsampling by <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data divisible by 2 <code class="docutils literal notranslate"><span class="pre">d_levels</span></code> times.</p></li>
<li><p><strong>o_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4</span> <span class="pre">int</span> <span class="pre">tuple</span></code>) – Original shape of <code class="docutils literal notranslate"><span class="pre">X</span></code>. E.g. <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">1000,</span> <span class="pre">1000,</span> <span class="pre">1)</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../bibliography.html" class="btn btn-neutral float-right" title="Bibliography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="grad_cam.html" class="btn btn-neutral float-left" title="Grad-CAM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Daniel Franco

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>