

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Util &mdash; EM Image Segmentation  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Post processing" href="post_processing.html" />
    <link rel="prev" title="Metrics" href="metrics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> EM Image Segmentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Step 0: Prepare environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html#step-1-data-preparation">Step 1: Data preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html#step-1-choose-a-template">Step 1: Choose a template</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html#step-3-run-the-code">Step 3: Run the code</a></li>
</ul>
<p class="caption"><span class="caption-text">Manuscripts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mitochondria.html">Mitochondria segmentation</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_2d_manipulation.html">2D Data manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_3d_manipulation.html">3D Data manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="post_processing.html">Post processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="grad_cam.html">Grad-CAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="adabound.html">Adabound</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EM Image Segmentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="API.html">&lt;no title&gt;</a> &raquo;</li>
        
      <li>Util</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-util">
<span id="util"></span><h1>Util<a class="headerlink" href="#module-util" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="util.limit_threads">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">limit_threads</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">threads_number</span><span class="o">=</span><span class="default_value">'1'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#limit_threads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.limit_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>Limits the number of threads for a python process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>threads_number</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of threads.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.set_seed">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">set_seed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seedValue</span><span class="o">=</span><span class="default_value">42</span></em>, <em class="sig-param"><span class="n">determinism</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#set_seed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.set_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the seed on multiple python modules to obtain results as
reproducible as possible.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seedValue</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Seed value.</p></li>
<li><p><strong>determinism</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – To force determism.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="util.TimeHistory">
<em class="property">class </em><code class="sig-prename descclassname">util.</code><code class="sig-name descname">TimeHistory</code><a class="reference internal" href="_modules/util.html#TimeHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.TimeHistory" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.callbacks.Callback</span></code></p>
<p>Class to record each epoch time.</p>
<p class="rubric">Methods</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_batch_begin</span></code>(batch[, logs])</p></td>
<td><p>A backwards compatibility alias for <cite>on_train_batch_begin</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_batch_end</span></code>(batch[, logs])</p></td>
<td><p>A backwards compatibility alias for <cite>on_train_batch_end</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#util.TimeHistory.on_epoch_begin" title="util.TimeHistory.on_epoch_begin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_epoch_begin</span></code></a>(batch[, logs])</p></td>
<td><p>Called at the start of an epoch.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#util.TimeHistory.on_epoch_end" title="util.TimeHistory.on_epoch_end"><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_epoch_end</span></code></a>(batch[, logs])</p></td>
<td><p>Called at the end of an epoch.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_predict_batch_begin</span></code>(batch[, logs])</p></td>
<td><p>Called at the beginning of a batch in <cite>predict</cite> methods.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_predict_batch_end</span></code>(batch[, logs])</p></td>
<td><p>Called at the end of a batch in <cite>predict</cite> methods.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_predict_begin</span></code>([logs])</p></td>
<td><p>Called at the beginning of prediction.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_predict_end</span></code>([logs])</p></td>
<td><p>Called at the end of prediction.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_test_batch_begin</span></code>(batch[, logs])</p></td>
<td><p>Called at the beginning of a batch in <cite>evaluate</cite> methods.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_test_batch_end</span></code>(batch[, logs])</p></td>
<td><p>Called at the end of a batch in <cite>evaluate</cite> methods.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_test_begin</span></code>([logs])</p></td>
<td><p>Called at the beginning of evaluation or validation.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_test_end</span></code>([logs])</p></td>
<td><p>Called at the end of evaluation or validation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_train_batch_begin</span></code>(batch[, logs])</p></td>
<td><p>Called at the beginning of a training batch in <cite>fit</cite> methods.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_train_batch_end</span></code>(batch[, logs])</p></td>
<td><p>Called at the end of a training batch in <cite>fit</cite> methods.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#util.TimeHistory.on_train_begin" title="util.TimeHistory.on_train_begin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_train_begin</span></code></a>([logs])</p></td>
<td><p>Called at the beginning of training.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">on_train_end</span></code>([logs])</p></td>
<td><p>Called at the end of training.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>set_model</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>set_params</strong></p></td>
<td></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt id="util.TimeHistory.on_train_begin">
<code class="sig-name descname">on_train_begin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logs</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#TimeHistory.on_train_begin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.TimeHistory.on_train_begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the beginning of training.</p>
<p>Subclasses should override for any actions to run.</p>
<dl class="simple">
<dt>Arguments:</dt><dd><dl class="simple">
<dt>logs: dict. Currently no data is passed to this argument for this method</dt><dd><p>but that may change in the future.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="util.TimeHistory.on_epoch_begin">
<code class="sig-name descname">on_epoch_begin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">batch</span></em>, <em class="sig-param"><span class="n">logs</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#TimeHistory.on_epoch_begin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.TimeHistory.on_epoch_begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the start of an epoch.</p>
<p>Subclasses should override for any actions to run. This function should only
be called during TRAIN mode.</p>
<dl>
<dt>Arguments:</dt><dd><p>epoch: integer, index of epoch.
logs: dict. Currently no data is passed to this argument for this method</p>
<blockquote>
<div><p>but that may change in the future.</p>
</div></blockquote>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="util.TimeHistory.on_epoch_end">
<code class="sig-name descname">on_epoch_end</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">batch</span></em>, <em class="sig-param"><span class="n">logs</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#TimeHistory.on_epoch_end"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.TimeHistory.on_epoch_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Called at the end of an epoch.</p>
<p>Subclasses should override for any actions to run. This function should only
be called during TRAIN mode.</p>
<dl>
<dt>Arguments:</dt><dd><p>epoch: integer, index of epoch.
logs: dict, metric results for this training epoch, and for the</p>
<blockquote>
<div><p>validation epoch if validation is performed. Validation result keys
are prefixed with <cite>val_</cite>.</p>
</div></blockquote>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="util.create_plots">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">create_plots</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">results</span></em>, <em class="sig-param"><span class="n">job_id</span></em>, <em class="sig-param"><span class="n">chartOutDir</span></em>, <em class="sig-param"><span class="n">metric</span><span class="o">=</span><span class="default_value">'jaccard_index'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#create_plots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.create_plots" title="Permalink to this definition">¶</a></dt>
<dd><p>Create loss and main metric plots with the given results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">History</span> <span class="pre">object</span></code>) – Record of training loss values and metrics values at successive
epochs. History object is returned by Keras <a class="reference external" href="https://keras.io/api/models/model_training_apis/#fit-method">fit()</a> method.</p></li>
<li><p><strong>job_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Jod identifier.</p></li>
<li><p><strong>chartOutDir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the charts will be stored into.</p></li>
<li><p><strong>metric</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Metric used.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-center" id="id10">
<a class="reference internal image-reference" href="_images/chart_loss.png"><img alt="_images/chart_loss.png" src="_images/chart_loss.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Loss values on each epoch</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-center" id="id11">
<a class="reference internal image-reference" href="_images/chart_jaccard_index.png"><img alt="_images/chart_jaccard_index.png" src="_images/chart_jaccard_index.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">Jaccard index values on each epoch</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py function">
<dt id="util.store_history">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">store_history</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">results</span></em>, <em class="sig-param"><span class="n">score</span></em>, <em class="sig-param"><span class="n">time_callback</span></em>, <em class="sig-param"><span class="n">log_dir</span></em>, <em class="sig-param"><span class="n">job_file</span></em>, <em class="sig-param"><span class="n">metric</span><span class="o">=</span><span class="default_value">'jaccard_index'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#store_history"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.store_history" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores the results obtained as csv to manipulate them later
and labeled in another file as historic results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">History</span> <span class="pre">object</span></code>) – Record of training loss values and metrics values at successive
epochs.</p></li>
<li><p><strong>score</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Dictionary</span></code>) – Contains all metrics values extracted from training and inference.</p></li>
<li><p><strong>time_callback</strong> (<code class="docutils literal notranslate"><span class="pre">util.TimeHistory</span></code>) – Time structure with the time of each epoch.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.threshold_plots">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">threshold_plots</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">preds_test</span></em>, <em class="sig-param"><span class="n">Y_test</span></em>, <em class="sig-param"><span class="n">det_eval_ge_path</span></em>, <em class="sig-param"><span class="n">det_eval_path</span></em>, <em class="sig-param"><span class="n">det_bin</span></em>, <em class="sig-param"><span class="n">n_dig</span></em>, <em class="sig-param"><span class="n">job_id</span></em>, <em class="sig-param"><span class="n">job_file</span></em>, <em class="sig-param"><span class="n">char_dir</span></em>, <em class="sig-param"><span class="n">r_val</span><span class="o">=</span><span class="default_value">0.5</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#threshold_plots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.threshold_plots" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a plot with the different metric values binarizing the prediction
with different thresholds, from 0.1 to 0.9.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>preds_test</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Predictions made by the model. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y_test</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Ground truth of the data. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>det_eval_ge_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the ground truth is stored for the DET calculation.</p></li>
<li><p><strong>det_eval_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the evaluation of the metric will be done.</p></li>
<li><p><strong>det_bin</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to the DET binary.</p></li>
<li><p><strong>n_dig</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The number of digits used for encoding temporal indices (e.g. <code class="docutils literal notranslate"><span class="pre">3</span></code>).
Used by the DET calculation binary.</p></li>
<li><p><strong>job_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Id of the job.</p></li>
<li><p><strong>job_file</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Id and run number of the job.</p></li>
<li><p><strong>char_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to store the charts generated.</p></li>
<li><p><strong>r_val</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Threshold values to return.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>t_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Value of the Jaccard index when the threshold is <code class="docutils literal notranslate"><span class="pre">r_val</span></code>.</p></li>
<li><p><strong>t_voc</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Value of VOC when the threshold is <code class="docutils literal notranslate"><span class="pre">r_val</span></code>.</p></li>
<li><p><strong>t_det</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Value of DET when the threshold is <code class="docutils literal notranslate"><span class="pre">r_val</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jac</span><span class="p">,</span> <span class="n">voc</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">threshold_plots</span><span class="p">(</span>
    <span class="n">preds_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">det_eval_ge_path</span><span class="p">,</span> <span class="n">det_eval_path</span><span class="p">,</span> <span class="n">det_bin</span><span class="p">,</span>
    <span class="n">n_dig</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="s1">&#39;278_3&#39;</span><span class="p">,</span> <span class="n">char_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Will generate 3 charts, one per each metric: IoU, VOC and DET. In the x
axis represents the 9 different thresholds applied, that is: <code class="docutils literal notranslate"><span class="pre">0.1,</span> <span class="pre">0.2,</span>
<span class="pre">0.3,</span> <span class="pre">...,</span> <span class="pre">0.9</span></code>. The y axis is the value of the metric in each chart. For
instance, the Jaccard/IoU chart will look like this:</p>
<a class="reference internal image-reference" href="_images/278_3_threshold_Jaccard.png"><img alt="_images/278_3_threshold_Jaccard.png" class="align-center" src="_images/278_3_threshold_Jaccard.png" style="width: 60%;" /></a>
<p>In this example, the best value, <code class="docutils literal notranslate"><span class="pre">0.868</span></code>, is obtained with a threshold
of <code class="docutils literal notranslate"><span class="pre">0.4</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="util.array_to_img">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">array_to_img</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">data_format</span><span class="o">=</span><span class="default_value">'channels_last'</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">'float32'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#array_to_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.array_to_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a 3D Numpy array to a PIL Image instance.</p>
<p>As the Keras array_to_img function in:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/keras-team/keras-preprocessing/blob/28b8c9a57703b60ea7d23a196c59da1edf987ca0/keras_preprocessing/image/utils.py#L230">keras_preprocessing/image/utils.py</a></p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="util.img_to_array">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">img_to_array</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span></em>, <em class="sig-param"><span class="n">data_format</span><span class="o">=</span><span class="default_value">'channels_last'</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">'float32'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#img_to_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.img_to_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a PIL Image instance to a Numpy array.</p>
<p>It’s a copy of the function <a class="reference external" href="https://github.com/keras-team/keras-preprocessing/blob/28b8c9a57703b60ea7d23a196c59da1edf987ca0/keras_preprocessing/image/utils.py#L288">keras_preprocessing/image/utils.py</a>.</p>
</dd></dl>

<dl class="py function">
<dt id="util.save_img">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">save_img</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_dir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">Y</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mask_dir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">scale_mask</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">extension</span><span class="o">=</span><span class="default_value">'.png'</span></em>, <em class="sig-param"><span class="n">filenames</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#save_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.save_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Save images in the given directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>, <em>optional</em>) – Data to save as images. The first dimension must be the number of
images. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store X images.</p></li>
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>, <em>optional</em>) – Masks to save as images. The first dimension must be the number of
images. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>scale_mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – To allow mask be multiplied by 255.</p></li>
<li><p><strong>mask_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store Y images.</p></li>
<li><p><strong>prefix</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to store generated charts.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <em>optional</em>) – Filenames that should be used when saving each image. If any provided
each image should be named as: <code class="docutils literal notranslate"><span class="pre">prefix</span> <span class="pre">+</span> <span class="pre">&quot;_x_&quot;</span> <span class="pre">+</span> <span class="pre">image_number</span> <span class="pre">+</span>
<span class="pre">extension</span></code> when <code class="docutils literal notranslate"><span class="pre">X.ndim</span> <span class="pre">&lt;</span> <span class="pre">4</span></code> and <code class="docutils literal notranslate"><span class="pre">prefix</span> <span class="pre">+</span> <span class="pre">&quot;_x_&quot;</span> <span class="pre">+</span> <span class="pre">image_number</span> <span class="pre">+</span>
<span class="pre">&quot;_&quot;</span> <span class="pre">+</span> <span class="pre">slice_numger</span> <span class="pre">+</span> <span class="pre">extension</span></code> otherwise. E.g. <code class="docutils literal notranslate"><span class="pre">prefix_x_000.png</span></code>
when <code class="docutils literal notranslate"><span class="pre">X.ndim</span> <span class="pre">&lt;</span> <span class="pre">4</span></code> or <code class="docutils literal notranslate"><span class="pre">prefix_x_000_000.png</span></code> when <code class="docutils literal notranslate"><span class="pre">X.ndim</span> <span class="pre">&gt;=</span> <span class="pre">4</span></code>.
The same applies to <code class="docutils literal notranslate"><span class="pre">Y</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.make_weight_map">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">make_weight_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">binary</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">w0</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#make_weight_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.make_weight_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a weight map in order to make the U-Net learn better the
borders of cells and distinguish individual cells that are tightly packed.
These weight maps follow the methodology of the original U-Net paper.</p>
<p>Based on <a class="reference external" href="https://github.com/deepimagej/python4deepimagej/blob/499955a264e1b66c4ed2c014cb139289be0e98a4/unet/py_files/helpers.py">unet/py_files/helpers.py</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>label</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">3D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Corresponds to a label image. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>binary</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Corresponds to whether or not the labels are binary.</p></li>
<li><p><strong>w0</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Controls for the importance of separating tightly associated entities.</p></li>
<li><p><strong>sigma</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Represents the standard deviation of the Gaussian used for the weight map.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p>Notice that weight has been defined where the objects are almost touching
each other.</p>
<a class="reference internal image-reference" href="_images/weight_map.png"><img alt="_images/weight_map.png" class="align-center" src="_images/weight_map.png" style="width: 650px;" /></a>
</dd></dl>

<dl class="py function">
<dt id="util.do_save_wm">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">do_save_wm</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">binary</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">w0</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#do_save_wm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.do_save_wm" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves the label images, applies the weight-map algorithm and save the
weight maps in a folder. Uses internally <a class="reference internal" href="#util.make_weight_map" title="util.make_weight_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">util.make_weight_map()</span></code></a>.</p>
<p>Based on <a class="reference external" href="https://github.com/deepimagej/python4deepimagej/blob/499955a264e1b66c4ed2c014cb139289be0e98a4/unet/py_files/helpers.py">deepimagejunet/py_files/helpers.py</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Corresponds to given label images. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Refers to the path where the weight maps should be saved.</p></li>
<li><p><strong>binary</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Corresponds to whether or not the labels are binary.</p></li>
<li><p><strong>w0</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Controls for the importance of separating tightly associated entities.</p></li>
<li><p><strong>sigma</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Represents the standard deviation of the Gaussian used for the weight
map.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.foreground_percentage">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">foreground_percentage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mask</span></em>, <em class="sig-param"><span class="n">class_tag</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#foreground_percentage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.foreground_percentage" title="Permalink to this definition">¶</a></dt>
<dd><p>Percentage of pixels that corresponds to the class in the given image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">2D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Image mask to analize.</p></li>
<li><p><strong>class_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Class to find in the image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>x</strong> – Percentage of pixels that corresponds to the class. Value between <code class="docutils literal notranslate"><span class="pre">0</span></code>
and <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.divide_images_on_classes">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">divide_images_on_classes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">data_mask</span></em>, <em class="sig-param"><span class="n">out_dir</span></em>, <em class="sig-param"><span class="n">num_classes</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">th</span><span class="o">=</span><span class="default_value">0.8</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#divide_images_on_classes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.divide_images_on_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a folder for each class where the images that have more pixels
labeled as the class (in percentage) than the given threshold will be
stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data to save as images. The first dimension must be the number of
images. <code class="docutils literal notranslate"><span class="pre">E.g.</span> <span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>data_mask</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data mask to save as images.  The first dimension must be the number
of images. <code class="docutils literal notranslate"><span class="pre">E.g.</span> <span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>out_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to save the images.</p></li>
<li><p><strong>num_classes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of classes.</p></li>
<li><p><strong>th</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Percentage of the pixels that must be labeled as a class to save it
inside that class folder.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.save_filters_of_convlayer">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">save_filters_of_convlayer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">out_dir</span></em>, <em class="sig-param"><span class="n">l_num</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">img_per_row</span><span class="o">=</span><span class="default_value">8</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#save_filters_of_convlayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.save_filters_of_convlayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an image of the filters learned by a convolutional layer. One can
identify the layer with <code class="docutils literal notranslate"><span class="pre">l_num</span></code> or <code class="docutils literal notranslate"><span class="pre">name</span></code> args. If both are passed
<code class="docutils literal notranslate"><span class="pre">name</span></code> will be prioritized.</p>
<p>Inspired by <a class="reference external" href="https://machinelearningmastery.com/how-to-visualize-filters-and-feature-maps-in-convolutional-neural-networks">https://machinelearningmastery.com/how-to-visualize-filters-and-feature-maps-in-convolutional-neural-networks</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Keras</span> <span class="pre">Model</span></code>) – Model where the layers are stored.</p></li>
<li><p><strong>out_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path where the image will be stored.</p></li>
<li><p><strong>l_num</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of the layer to extract filters from.</p></li>
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Name of the layer to extract filters from.</p></li>
<li><p><strong>prefix</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Prefix to add to the output image name.</p></li>
<li><p><strong>img_per_row</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Filters per row on the image.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">l_num</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> not provided.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To save the filters learned by the layer called <code class="docutils literal notranslate"><span class="pre">conv1</span></code> one can call
the function as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">save_filters_of_convlayer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">char_dir</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;conv1&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>That will save in <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> an image like this:</p>
<a class="reference internal image-reference" href="_images/save_filters.png"><img alt="_images/save_filters.png" class="align-center" src="_images/save_filters.png" style="width: 60%;" /></a>
</dd></dl>

<dl class="py function">
<dt id="util.calculate_2D_volume_prob_map">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">calculate_2D_volume_prob_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">Y_path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">w_foreground</span><span class="o">=</span><span class="default_value">0.94</span></em>, <em class="sig-param"><span class="n">w_background</span><span class="o">=</span><span class="default_value">0.06</span></em>, <em class="sig-param"><span class="n">save_dir</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#calculate_2D_volume_prob_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.calculate_2D_volume_prob_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the probability map of the given 2D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data to calculate the probability map from. E. g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span>
<span class="pre">y,</span> <span class="pre">channel)</span></code></p></li>
<li><p><strong>Y_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to load the data from in case <code class="docutils literal notranslate"><span class="pre">Y=None</span></code>.</p></li>
<li><p><strong>w_foreground</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the foreground. This value plus <code class="docutils literal notranslate"><span class="pre">w_background</span></code> must be
equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>w_background</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the background. This value plus <code class="docutils literal notranslate"><span class="pre">w_foreground</span></code> must be
equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>save_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to the file where the probability map will be stored.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">Y</span></code> does not have 4 dimensions.</p></li>
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">w_foreground</span> <span class="pre">+</span> <span class="pre">w_background</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>Array</strong> – Path where the probability map/s is/are stored if <code class="docutils literal notranslate"><span class="pre">Y_path</span></code> was
given and there are images of different shapes. Otherwise, an array
that represents the probability map of <code class="docutils literal notranslate"><span class="pre">Y</span></code> or all loaded data files
from <code class="docutils literal notranslate"><span class="pre">Y_path</span></code> will be returned.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Str</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.calculate_3D_volume_prob_map">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">calculate_3D_volume_prob_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">Y_path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">w_foreground</span><span class="o">=</span><span class="default_value">0.94</span></em>, <em class="sig-param"><span class="n">w_background</span><span class="o">=</span><span class="default_value">0.06</span></em>, <em class="sig-param"><span class="n">save_dir</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#calculate_3D_volume_prob_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.calculate_3D_volume_prob_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the probability map of the given 3D data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code>) – Data to calculate the probability map from. E. g. <code class="docutils literal notranslate"><span class="pre">(num_subvolumes,</span>
<span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channel)</span></code></p></li>
<li><p><strong>Y_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to load the data from in case <code class="docutils literal notranslate"><span class="pre">Y=None</span></code>.</p></li>
<li><p><strong>w_foreground</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the foreground. This value plus <code class="docutils literal notranslate"><span class="pre">w_background</span></code> must be
equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>w_background</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <em>optional</em>) – Weight of the background. This value plus <code class="docutils literal notranslate"><span class="pre">w_foreground</span></code> must be
equal <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>save_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Path to the directory where the probability map will be stored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>Array</strong> – Path where the probability map/s is/are stored if <code class="docutils literal notranslate"><span class="pre">Y_path</span></code> was
given and there are images of different shapes. Otherwise, an array
that represents the probability map of <code class="docutils literal notranslate"><span class="pre">Y</span></code> or all loaded data files
from <code class="docutils literal notranslate"><span class="pre">Y_path</span></code> will be returned.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Str</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">Y</span></code> does not have 5 dimensions.</p></li>
<li><p><strong>ValueError</strong> – if <code class="docutils literal notranslate"><span class="pre">w_foreground</span> <span class="pre">+</span> <span class="pre">w_background</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.grayscale_2D_image_to_3D">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">grayscale_2D_image_to_3D</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">th</span><span class="o">=</span><span class="default_value">127</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#grayscale_2D_image_to_3D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.grayscale_2D_image_to_3D" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates 3D surface from each image in X based on the grayscale of each
image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data that contains the images to create the surfaces from. E.g.
<code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – Data mask of the same shape of X that will be converted into 3D volume,
stacking multiple times each image. Useful if you need the two data
arrays to be of the same shape. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>th</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Values to ommit when creating the surfaces. Useful to reduce the
amount of data in z to be created and reduce computational time.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>Array</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – 3D surface of each image provided. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">z,</span> <span class="pre">x,</span> <span class="pre">y,</span>
<span class="pre">channels)</span></code>.</p></li>
<li><p><strong>Array</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">numpy</span> <span class="pre">array</span></code>) – 3D stack of each mask provided. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">z,</span> <span class="pre">x,</span> <span class="pre">y,</span>
<span class="pre">channels)</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.check_masks">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">check_masks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">n_classes</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#check_masks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.check_masks" title="Permalink to this definition">¶</a></dt>
<dd><p>Check wheter the data masks have the correct labels inspection a few
random images of the given path. If the function gives no error one
should assume that the masks are correct.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to the data mask.</p></li>
<li><p><strong>n_classes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Maximum classes that the masks must contain.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.img_to_onehot_encoding">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">img_to_onehot_encoding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span></em>, <em class="sig-param"><span class="n">num_classes</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#img_to_onehot_encoding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.img_to_onehot_encoding" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts image given into one-hot encode format.</p>
<p>The opposite function is <a class="reference internal" href="#util.onehot_encoding_to_img" title="util.onehot_encoding_to_img"><code class="xref py py-func docutils literal notranslate"><span class="pre">onehot_encoding_to_img()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code>) – Image. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code> or <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>num_classes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <em>optional</em>) – Number of classes to distinguish.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>one_hot_labels</strong> – Data one-hot encoded. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">num_classes)</span></code> or
<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">num_classes)</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.onehot_encoding_to_img">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">onehot_encoding_to_img</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">encoded_image</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#onehot_encoding_to_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.onehot_encoding_to_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts one-hot encode image into an image with jus tone channel and all
the classes represented by an integer.</p>
<p>The opposite function is <a class="reference internal" href="#util.img_to_onehot_encoding" title="util.img_to_onehot_encoding"><code class="xref py py-func docutils literal notranslate"><span class="pre">img_to_onehot_encoding()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>encoded_image</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code>) – Image. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code> or <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>img</strong> – Data one-hot encoded. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">num_classes)</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Numpy</span> <span class="pre">3D/4D</span> <span class="pre">array</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.load_data_from_dir">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">load_data_from_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_dir</span></em>, <em class="sig-param"><span class="n">crop</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">crop_shape</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">overlap</span><span class="o">=</span><span class="default_value">0, 0</span></em>, <em class="sig-param"><span class="n">padding</span><span class="o">=</span><span class="default_value">0, 0</span></em>, <em class="sig-param"><span class="n">return_filenames</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#load_data_from_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.load_data_from_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Load data from a directory. If <code class="docutils literal notranslate"><span class="pre">crop=False</span></code> all the data is suposed to
have the same shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to read the data from.</p></li>
<li><p><strong>crop</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Crop each image into desired shape pointed by <code class="docutils literal notranslate"><span class="pre">crop_shape</span></code>.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3</span> <span class="pre">ints</span></code>, <em>optional</em>) – Shape of the crop to be made. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>overlap</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">2</span> <span class="pre">floats</span></code>, <em>optional</em>) – Amount of minimum overlap on x and y dimensions. The values must
be on range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1)</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">0%</span></code> or <code class="docutils literal notranslate"><span class="pre">99%</span></code> of overlap.
E. g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code>.</p></li>
<li><p><strong>padding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">2</span> <span class="pre">ints</span></code>, <em>optional</em>) – Size of padding to be added on each axis <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code>.
E.g. <code class="docutils literal notranslate"><span class="pre">(24,</span> <span class="pre">24)</span></code>.</p></li>
<li><p><strong>return_filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Return a list with the loaded filenames. Useful when you need to save
them afterwards with the same names as the original ones.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3D</span> <span class="pre">Numpy</span> <span class="pre">arrays</span></code>) – Data loaded. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">y,</span> <span class="pre">x,</span> <span class="pre">channels)</span></code> if all files
have same shape, otherwise a list of <code class="docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">x,</span> <span class="pre">channels)</span></code> arrays
will be returned.</p></li>
<li><p><strong>data_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shapes of all 3D images readed. Useful to reconstruct the original
images together with <code class="docutils literal notranslate"><span class="pre">crop_shape</span></code>.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shape of the loaded 3D images after cropping. Useful to reconstruct
the original images together with <code class="docutils literal notranslate"><span class="pre">data_shape</span></code>.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Loaded filenames.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<dl>
<dt>::</dt><dd><p># EXAMPLE 1
# Case where we need to load 165 images of shape (1024, 768)
data_path = “data/train/x”</p>
<p>load_data_from_dir(data_path)
# The function will print the shape of the created array. In this example:
#     <a href="#id2"><span class="problematic" id="id3">**</span></a>* Loaded data shape is (165, 768, 1024, 1)
# Notice height and width swap because of Numpy ndarray terminology</p>
<p># EXAMPLE 2
# Case where we need to load 165 images of shape (1024, 768) but
# cropping them into (256, 256, 1) patches
data_path = “data/train/x”
crop_shape = (256, 256, 1)</p>
<p>load_data_from_dir(data_path, crop=True, crop_shape=crop_shape)
# The function will print the shape of the created array. In this example:
#     <a href="#id4"><span class="problematic" id="id5">**</span></a>* Loaded data shape is (1980, 256, 256, 1)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="util.load_ct_data_from_dir">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">load_ct_data_from_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_dir</span></em>, <em class="sig-param"><span class="n">shape</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#load_ct_data_from_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.load_ct_data_from_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Load CT data from a directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to read the data from.</p></li>
<li><p><strong>shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">3D</span> <span class="pre">int</span> <span class="pre">tuple</span></code>, <em>optional</em>) – Shape of the data to load. If is not provided the shape is
calculated automatically looping over all data files and it will be
the maximum value found per axis. So, given the value the process
should be faster. E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">channels)</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – Data loaded. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">y,</span> <span class="pre">x,</span> <span class="pre">channels)</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EXAMPLE 1</span>
<span class="c1"># Case where we need to load 165 images of shape (1024, 768)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;data/train/x&quot;</span>
<span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">load_data_from_dir</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">data_shape</span><span class="p">)</span>

<span class="c1"># The function will print list&#39;s first position array&#39;s shape. In this example:</span>
<span class="c1">#     *** Loaded data[0] shape is (165, 768, 1024, 1)</span>
<span class="c1"># Notice height and width swap because of Numpy ndarray terminology</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="util.load_3d_images_from_dir">
<code class="sig-prename descclassname">util.</code><code class="sig-name descname">load_3d_images_from_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_dir</span></em>, <em class="sig-param"><span class="n">crop</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">crop_shape</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">overlap</span><span class="o">=</span><span class="default_value">0, 0, 0</span></em>, <em class="sig-param"><span class="n">padding</span><span class="o">=</span><span class="default_value">0, 0, 0</span></em>, <em class="sig-param"><span class="n">median_padding</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">return_filenames</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util.html#load_3d_images_from_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#util.load_3d_images_from_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Load data from a directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to read the data from.</p></li>
<li><p><strong>crop</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Crop each 3D image when readed.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">4</span> <span class="pre">ints</span></code>, <em>optional</em>) – Shape of the subvolumes to create when cropping.
E.g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code>.</p></li>
<li><p><strong>overlap</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3</span> <span class="pre">floats</span></code>, <em>optional</em>) – Amount of minimum overlap on x, y and z dimensions. The values must
be on range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1)</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">0%</span></code> or <code class="docutils literal notranslate"><span class="pre">99%</span></code> of overlap.
E. g. <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>.</p></li>
<li><p><strong>padding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">3</span> <span class="pre">ints</span></code>, <em>optional</em>) – Size of padding to be added on each axis <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>.
E.g. <code class="docutils literal notranslate"><span class="pre">(24,</span> <span class="pre">24,</span> <span class="pre">24)</span></code>.</p></li>
<li><p><strong>median_padding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code> the padding value is the median value. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the`
added values are zeroes.</p></li>
<li><p><strong>return_filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <em>optional</em>) – Return a list with the loaded filenames. Useful when you need to save
them afterwards with the same names as the original ones.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">5D</span> <span class="pre">Numpy</span> <span class="pre">array</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">4D</span> <span class="pre">Numpy</span> <span class="pre">arrays</span></code>) – Data loaded. E.g. <code class="docutils literal notranslate"><span class="pre">(num_of_images,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code> if all files
have same shape, otherwise a list of <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z,</span> <span class="pre">channels)</span></code> arrays
will be returned.</p></li>
<li><p><strong>data_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shapes of all 3D images readed. Useful to reconstruct the original
images together with <code class="docutils literal notranslate"><span class="pre">crop_shape</span></code>.</p></li>
<li><p><strong>crop_shape</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuples</span></code>) – Shape of the loaded 3D images after cropping. Useful to reconstruct
the original images together with <code class="docutils literal notranslate"><span class="pre">data_shape</span></code>.</p></li>
<li><p><strong>filenames</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <em>optional</em>) – Loaded filenames.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<dl>
<dt>::</dt><dd><p># EXAMPLE 1
# Case where we need to load 20 images of shape (1024, 1024, 91, 1)
data_path = “data/train/x”</p>
<p>data = load_data_from_dir(data_path)
# The function will print list’s first position array’s shape. In this example:
#     <a href="#id6"><span class="problematic" id="id7">**</span></a>* Loaded data[0] shape is (20, 91, 1024, 1024, 1)
# Notice height, width and depth swap as skimage.io imread function
# is used to load images</p>
<p># EXAMPLE 2
# Same as example 1 but with unknown shape, cropping them into (256, 256, 40, 1) subvolumes
# with minimum overlap and storing filenames.
data_path = “data/train/x”</p>
<dl class="simple">
<dt>X_test, orig_test_img_shapes,            crop_test_img_shapes, te_filenames = load_3d_images_from_dir(</dt><dd><p>test_path, crop=True, crop_shape=(256, 256, 40, 1), overlap=(0,0,0),
return_filenames=True)</p>
</dd>
</dl>
<p># The function will print the shape of the created array which its size is
# the concatenation in 0 axis of all subvolumes created for each 3D image in the
# given path. For example:
#     <a href="#id8"><span class="problematic" id="id9">**</span></a>* Loaded data shape is (350, 256, 256, 40, 1)
# Notice height, width and depth swap as skimage.io imread function
# is used to load images.</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="post_processing.html" class="btn btn-neutral float-right" title="Post processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="metrics.html" class="btn btn-neutral float-left" title="Metrics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Daniel Franco

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>